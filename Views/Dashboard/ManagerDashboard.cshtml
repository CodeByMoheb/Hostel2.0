@model Hostel2._0.Models.ViewModels.DashboardViewModels.ManagerDashboardViewModel
@using Hostel2._0.Models.Enums

@{
    ViewData["Title"] = "Manager Dashboard";
}

@section Styles {
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body, .container-fluid {
            font-family: 'Inter', 'Roboto', Arial, sans-serif;
            background: linear-gradient(135deg, #e0e7ff 0%, #f4f6fa 100%);
        }
        .sidebar {
            position: fixed;
            top: 0; left: 0; bottom: 0;
            width: 210px;
            background: #232946;
            box-shadow: 2px 0 12px rgba(0,0,0,0.08);
            z-index: 1000;
            padding: 1.5rem 1rem 1rem 1rem;
            display: flex;
            flex-direction: column;
            transition: width 0.2s;
        }
        .sidebar .sidebar-header {
            font-size: 1.4rem;
            font-weight: 700;
            color: #fff;
            margin-bottom: 2rem;
            letter-spacing: 1px;
        }
        .sidebar .nav-link {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            color: #b8c1ec;
            font-size: 1.08rem;
            padding: 0.7rem 0.9rem;
            border-radius: 8px;
            margin-bottom: 0.3rem;
            transition: background 0.18s, color 0.18s;
            text-decoration: none;
        }
        .sidebar .nav-link.active, .sidebar .nav-link:hover {
            background: #eebbc3;
            color: #232946;
        }
        .sidebar .sidebar-toggle {
            margin-top: auto;
            background: none;
            border: none;
            color: #b8c1ec;
            font-size: 1.3rem;
            cursor: pointer;
            padding: 0.5rem 0;
        }
        .main-content {
            margin-left: 210px;
            padding: 2.2rem 2.2rem 1.5rem 2.2rem;
            transition: margin-left 0.2s;
        }
        @@media (max-width: 900px) {
            .sidebar { position: fixed; left: -210px; }
            .sidebar.open { left: 0; }
            .main-content { margin-left: 0; padding: 1rem; }
            .metrics-row, .card-list { flex-direction: column; gap: 0.7rem; }
        }
        .dashboard-header {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
        }
        .dashboard-title {
            font-size: 2rem;
            font-weight: 700;
            color: #232946;
            letter-spacing: 0.5px;
        }
        .dashboard-status {
            font-size: 1.1rem;
            font-weight: 600;
            color: #43A047;
            background: #eafbea;
            border-radius: 7px;
            padding: 0.3em 1.1em;
            margin-left: 1rem;
        }
        .metrics-row {
            display: flex;
            gap: 1.5rem;
            margin-bottom: 2.2rem;
            flex-wrap: wrap;
        }
        .metric-card {
            flex: 1 1 180px;
            min-width: 180px;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 2px 16px rgba(35,41,70,0.07);
            padding: 1.2rem 1.4rem;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            position: relative;
            transition: box-shadow 0.18s, transform 0.18s;
            animation: fadeInUp 0.7s;
        }
        .metric-card:hover {
            box-shadow: 0 8px 32px rgba(35,41,70,0.13);
            transform: translateY(-2px) scale(1.03);
        }
        .metric-title {
            font-size: 1.08rem;
            color: #888;
            margin-bottom: 0.3rem;
            font-weight: 600;
        }
        .metric-value {
            font-size: 2.1rem;
            font-weight: 800;
            color: #232946;
            margin-bottom: 0.2rem;
            letter-spacing: 1px;
            transition: color 0.2s;
        }
        .metric-badge {
            font-size: 0.95rem;
            font-weight: 700;
            color: #fff;
            background: #1976D2;
            border-radius: 8px;
            padding: 0.2em 0.7em;
            margin-left: 0.5rem;
        }
        .metric-progress {
            width: 100%;
            height: 7px;
            background: #e3e8f0;
            border-radius: 4px;
            margin-top: 0.5rem;
            overflow: hidden;
        }
        .metric-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #1976D2, #eebbc3);
            border-radius: 4px;
            transition: width 0.7s cubic-bezier(.4,0,.2,1);
        }
        .section {
            margin-bottom: 2.2rem;
        }
        .section-header {
            font-size: 1.25rem;
            font-weight: 700;
            color: #232946;
            margin-bottom: 1.1rem;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            gap: 0.7rem;
            border-left: 5px solid #eebbc3;
            padding-left: 0.7rem;
        }
        .card-list {
            display: flex;
            flex-wrap: wrap;
            gap: 1.2rem;
        }
        .card-list .dashboard-card {
            flex: 1 1 320px;
            min-width: 320px;
            background: #f9fafc;
            border: 1px solid #e3e8f0;
            border-radius: 14px;
            box-shadow: 0 2px 8px rgba(35,41,70,0.04);
            padding: 1.2rem 1.5rem;
            font-weight: 600;
            color: #232946;
            display: flex;
            align-items: center;
            gap: 0.7rem;
            transition: box-shadow 0.18s, transform 0.18s;
            animation: fadeIn 0.7s;
        }
        .quick-action-btn {
            background: linear-gradient(90deg, #eebbc3 60%, #b8c1ec 100%);
            color: #232946 !important;
            border: none;
            font-weight: 700;
            font-size: 1.1rem;
            box-shadow: 0 2px 8px rgba(238,187,195,0.09);
            transition: background 0.18s, color 0.18s;
        }
        .quick-action-btn:hover {
            background: linear-gradient(90deg, #b8c1ec 60%, #eebbc3 100%);
            color: #232946 !important;
        }
        .dashboard-card {
            background: #fff;
            border-radius: 14px;
            box-shadow: 0 2px 12px rgba(35,41,70,0.07);
            padding: 1.1rem 1.2rem;
            margin-bottom: 1.2rem;
            animation: fadeIn 0.7s;
        }
        .table th, .table td {
            font-size: 1.01rem;
            padding: 0.55rem 0.9rem;
        }
        .table th {
            font-weight: 700;
            color: #232946;
            background: #f4f6fa;
        }
        .table-hover tbody tr:hover {
            background: #eebbc3;
            transition: background 0.18s;
        }
        .table-striped tbody tr:nth-of-type(odd) {
            background: #f9fafc;
        }
        .badge {
            border-radius: 7px;
            font-size: 0.93rem;
            padding: 0.3em 0.8em;
            font-weight: 600;
        }
        .bg-success { background: #43A047 !important; color: #fff !important; }
        .bg-warning { background: #FFA000 !important; color: #333 !important; }
        .bg-info { background: #1976D2 !important; color: #fff !important; }
        .bg-danger { background: #E74C3C !important; color: #fff !important; }
        .bg-primary { background: #232946 !important; color: #fff !important; }
        .bg-light { background: #F5F7FA !important; color: #333 !important; }
        .btn, .btn-sm {
            border-radius: 8px;
            font-size: 1.01rem;
            padding: 0.38rem 0.9rem;
            font-weight: 600;
            background: #232946;
            color: #fff;
            border: none;
            transition: background 0.18s, box-shadow 0.18s;
        }
        .btn:hover, .btn-sm:hover {
            background: #eebbc3;
            color: #232946;
        }
        @@keyframes fadeIn {
            from { opacity: 0; transform: translateY(30px);} to { opacity: 1; transform: translateY(0);}
        }
        @@keyframes fadeInUp {
            from { opacity: 0; transform: translateY(40px);} to { opacity: 1; transform: translateY(0);}
        }
    </style>
}

<div class="sidebar" id="sidebar">
    <div class="sidebar-header">Hostel2.0</div>
    <a href="/Dashboard/ManagerDashboard" class="nav-link active"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
    <a href="/Room" class="nav-link"><i class="fas fa-door-open"></i> Rooms</a>
    <a href="/Student" class="nav-link"><i class="fas fa-users"></i> Students</a>
    <a href="/Notice" class="nav-link"><i class="fas fa-bullhorn"></i> Notices</a>
    <a href="/Maintenance" class="nav-link"><i class="fas fa-tools"></i> Maintenance</a>
    <button class="sidebar-toggle" onclick="toggleSidebar()"><i class="fas fa-angle-double-left"></i></button>
</div>
<div class="main-content" id="mainContent">
    <div class="dashboard-header">
        <div class="dashboard-title">@Model.Hostel?.Name</div>
        @if (Model.Hostel?.IsActive ?? false)
        {
            <span class="dashboard-status">Active</span>
        }
        else if (Model.Hostel != null)
        {
            <span class="dashboard-status" style="background:#FFF3CD;color:#856404;">Pending Approval</span>
        }
    </div>
    <div class="metrics-row">
        <div class="metric-card">
            <span class="metric-title"><i class="fas fa-door-open"></i> Total Rooms</span>
            <span class="metric-value">@Model.TotalRooms</span>
            <div class="metric-progress"><div class="metric-progress-bar" style="width:@(Model.TotalRooms > 0 ? Math.Min(Model.TotalRooms * 10, 100) : 5)%"></div></div>
        </div>
        <div class="metric-card">
            <span class="metric-title"><i class="fas fa-users"></i> Total Students</span>
            <span class="metric-value">@Model.TotalStudents</span>
            <div class="metric-progress"><div class="metric-progress-bar" style="width:@(Model.TotalStudents > 0 ? Math.Min(Model.TotalStudents * 10, 100) : 5)%"></div></div>
        </div>
        <div class="metric-card">
            <span class="metric-title"><i class="fas fa-money-check-alt"></i> Payments Received (This Month)</span>
            <span class="metric-value">৳@Model.TotalPaymentsThisMonth.ToString("N0")</span>
            <div class="metric-progress"><div class="metric-progress-bar" style="width:@(Model.TotalPaymentsThisMonth > 0 ? 100 : 5)%"></div></div>
        </div>
        <div class="metric-card">
            <span class="metric-title"><i class="fas fa-hourglass-half"></i> Pending Payments</span>
            <span class="metric-value">৳@Model.TotalPendingPayments.ToString("N0")</span>
            <div class="metric-progress"><div class="metric-progress-bar" style="width:@(Model.TotalPendingPayments > 0 ? 100 : 5)%"></div></div>
        </div>
        <div class="metric-card">
            <span class="metric-title"><i class="fas fa-user-clock"></i> Students With Dues</span>
            <span class="metric-value">@Model.StudentsWithDues</span>
            <div class="metric-progress"><div class="metric-progress-bar" style="width:@(Model.StudentsWithDues > 0 ? 100 : 5)%"></div></div>
        </div>
    </div>
    <div class="section">
        <div class="section-header"><i class="fas fa-bolt"></i> Quick Actions</div>
        <div class="card-list">
            <a asp-controller="Room" asp-action="Create" class="dashboard-card quick-action-btn"><i class="fas fa-door-open"></i> Add New Room</a>
            <a asp-controller="Student" asp-action="Create" class="dashboard-card quick-action-btn"><i class="fas fa-user-plus"></i> Add New Student</a>
            <a asp-controller="Notice" asp-action="Create" class="dashboard-card quick-action-btn"><i class="fas fa-bullhorn"></i> Post New Notice</a>
        </div>
    </div>
    <div class="section">
        <div class="section-header"><i class="fas fa-bed"></i> Recent Rooms</div>
        <div class="dashboard-card">
            <div class="table-responsive">
                <table class="table table-hover align-middle mb-0">
                    <thead>
                        <tr>
                            <th>Room #</th>
                            <th>Type</th>
                            <th>Capacity</th>
                            <th>Rent</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var room in Model.Rooms)
                        {
                            <tr>
                                <td>@room.RoomNumber</td>
                                <td>@room.Type</td>
                                <td>@room.Capacity</td>
                                <td>৳@room.MonthlyRent.ToString("N0")</td>
                                <td>
                                    <span class="badge bg-@(room.Students.Count >= room.Capacity ? "danger" : "success")">
                                        @(room.Students.Count >= room.Capacity ? "Full" : "Available")
                                    </span>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div class="section">
        <div class="section-header"><i class="fas fa-user-graduate"></i> Recent Students</div>
        <div class="dashboard-card">
            <div class="table-responsive">
                <table class="table table-hover align-middle mb-0">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Student ID</th>
                            <th>Room</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var student in Model.Students)
                        {
                            <tr>
                                <td>@student.FullName</td>
                                <td>@student.StudentId</td>
                                <td>@(student.Room?.RoomNumber ?? "Not Assigned")</td>
                                <td>
                                    <span class="badge bg-@(student.IsActive ? "success" : "warning")">
                                        @(student.IsActive ? "Active" : "Inactive")
                                    </span>
                                </td>
                                <td>
                                    <div class="btn-group">
                                        <a asp-controller="Student" asp-action="Edit" asp-route-id="@student.Id" class="btn btn-sm"><i class="fas fa-edit"></i></a>
                                        <a asp-controller="Student" asp-action="Details" asp-route-id="@student.Id" class="btn btn-sm bg-info"><i class="fas fa-info-circle"></i></a>
                                    </div>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div class="section">
        <div class="section-header"><i class="fas fa-bullhorn"></i> Recent Notices</div>
        <div class="dashboard-card">
            <div class="table-responsive">
                <table class="table table-hover align-middle mb-0">
                    <thead>
                        <tr><th>Title</th><th>Content</th><th>Date</th></tr>
                    </thead>
                    <tbody>
                        @foreach (var notice in Model.RecentNotices)
                        {
                            <tr>
                                <td>@notice.Title</td>
                                <td>@notice.Content</td>
                                <td>@notice.CreatedAt.ToString("MMM dd, yyyy")</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div class="section">
        <div class="section-header"><i class="fas fa-tools"></i> Recent Maintenance Requests</div>
        <div class="dashboard-card">
            <div class="table-responsive">
                <table class="table table-hover align-middle mb-0">
                    <thead>
                        <tr><th>Title</th><th>Description</th><th>Status</th></tr>
                    </thead>
                    <tbody>
                        @foreach (var request in Model.RecentMaintenanceRequests)
                        {
                            <tr>
                                <td>@request.Title</td>
                                <td>@request.Description</td>
                                <td>
                                    <span class="badge bg-@(request.Status == MaintenanceStatus.Pending ? "warning" : request.Status == MaintenanceStatus.InProgress ? "info" : request.Status == MaintenanceStatus.Completed ? "success" : "secondary")">
                                        @request.Status
                                    </span>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div class="section">
        <div class="section-header"><i class="fas fa-receipt"></i> Recent Payments</div>
        <div class="dashboard-card">
            <div class="table-responsive">
                <table class="table table-hover align-middle mb-0">
                    <thead>
                        <tr>
                            <th>Student</th>
                            <th>Amount</th>
                            <th>Month</th>
                            <th>Status</th>
                            <th>Receipt</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var payment in Model.RecentPayments)
                        {
                            <tr>
                                <td>@payment.Student?.FullName</td>
                                <td>৳@payment.Amount.ToString("N0")</td>
                                <td>@payment.PaymentDate.ToString("MMM yyyy")</td>
                                <td>
                                    <span class="badge bg-@(payment.Status == PaymentStatus.Completed ? "success" : payment.Status == PaymentStatus.Pending ? "warning" : "danger")">
                                        @payment.Status
                                    </span>
                                </td>
                                <td>
                                    <a asp-controller="Payment" asp-action="GenerateReceipt" asp-route-id="@payment.Id" class="btn btn-sm btn-info"><i class="fas fa-receipt"></i> View</a>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div class="section">
        <div class="section-header"><i class="fas fa-list"></i> All Students, Rooms & Payment Status</div>
        <div class="dashboard-card">
            <div class="table-responsive">
                <table class="table table-hover align-middle mb-0">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Student ID</th>
                            <th>Room</th>
                            <th>Payment Status</th>
                            <th>Amount</th>
                            <th>Month</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var row in Model.AllStudentPayments)
                        {
                            <tr>
                                <td>@row.Student.FullName</td>
                                <td>@row.Student.StudentId</td>
                                <td>@(row.Room?.RoomNumber ?? "Not Assigned")</td>
                                <td>
                                    @if (row.LatestPayment != null)
                                    {
                                        <span class="badge bg-@(row.LatestPayment.Status == PaymentStatus.Completed ? "success" : row.LatestPayment.Status == PaymentStatus.Pending ? "warning" : "danger")">
                                            @row.LatestPayment.Status
                                        </span>
                                    }
                                    else
                                    {
                                        <span class="badge bg-secondary">No Payment</span>
                                    }
                                </td>
                                <td>
                                    @if (row.LatestPayment != null)
                                    {
                                        @("৳" + row.LatestPayment.Amount.ToString("N0"))
                                    }
                                    else
                                    {
                                        <span class="text-muted">-</span>
                                    }
                                </td>
                                <td>
                                    @if (row.LatestPayment != null)
                                    {
                                        @row.LatestPayment.PaymentDate.ToString("MMM yyyy")
                                    }
                                    else
                                    {
                                        <span class="text-muted">-</span>
                                    }
                                </td>
                                <td>
                                    @if (row.LatestPayment != null && row.LatestPayment.Status == PaymentStatus.Pending)
                                    {
                                        <form asp-controller="Payment" asp-action="UpdateStatus" method="post" style="display:inline;">
                                            <input type="hidden" name="id" value="@row.LatestPayment.Id" />
                                            <input type="hidden" name="status" value="Completed" />
                                            <button type="submit" class="btn btn-success btn-sm">Mark as Paid</button>
                                        </form>
                                    }
                                    else
                                    {
                                        <span class="text-muted">-</span>
                                    }
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function toggleSidebar() {
            var sidebar = document.getElementById('sidebar');
            var mainContent = document.getElementById('mainContent');
            sidebar.classList.toggle('collapsed');
            mainContent.classList.toggle('sidebar-collapsed');
        }
        // Responsive sidebar for mobile
        if(window.innerWidth < 900) {
            document.getElementById('sidebar').classList.add('collapsed');
        }
    </script>
} 